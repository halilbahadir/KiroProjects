INFO:     Will watch for changes in these directories: ['/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [40159] using StatReload
{"timestamp": "2025-11-26T20:25:35.207523Z", "level": "INFO", "logger": "src.main", "message": "FastAPI application created and configured", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 251, "function": "create_app"}}
INFO:     Started server process [40232]
INFO:     Waiting for application startup.
{"timestamp": "2025-11-26T20:25:35.208513Z", "level": "INFO", "logger": "src.main", "message": "============================================================", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 148, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208547Z", "level": "INFO", "logger": "src.main", "message": "Shopping Assistant Chatbot Service starting up", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 149, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208571Z", "level": "INFO", "logger": "src.main", "message": "Server: 0.0.0.0:8000", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 150, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208594Z", "level": "INFO", "logger": "src.main", "message": "Bedrock Model: us.amazon.nova-pro-v1:0", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 151, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208612Z", "level": "INFO", "logger": "src.main", "message": "AWS Region: us-west-2", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 152, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208631Z", "level": "INFO", "logger": "src.main", "message": "Backend API: http://localhost:3001", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 153, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208650Z", "level": "INFO", "logger": "src.main", "message": "Log Level: INFO", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 154, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208666Z", "level": "INFO", "logger": "src.main", "message": "============================================================", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 155, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208681Z", "level": "INFO", "logger": "src.main", "message": "Initializing agent manager...", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 159, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.208704Z", "level": "INFO", "logger": "src.api.routes", "message": "Initializing agent manager for API routes", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/api/routes.py", "line": 46, "function": "initialize_agent_manager"}}
{"timestamp": "2025-11-26T20:25:35.208726Z", "level": "INFO", "logger": "src.agent_manager", "message": "Initializing AgentManager", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 47, "function": "__init__"}}
{"timestamp": "2025-11-26T20:25:35.208745Z", "level": "INFO", "logger": "src.agent_manager", "message": "Initializing Bedrock model: us.amazon.nova-pro-v1:0 in region us-west-2", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 68, "function": "_initialize_bedrock_model"}}
{"timestamp": "2025-11-26T20:25:35.208764Z", "level": "INFO", "logger": "src.agent_manager", "message": "Using AWS CLI default credentials (no explicit credentials provided)", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 100, "function": "_initialize_bedrock_model"}}
{"timestamp": "2025-11-26T20:25:35.225861Z", "level": "INFO", "logger": "botocore.credentials", "message": "Found credentials in shared credentials file: ~/.aws/credentials", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/botocore/credentials.py", "line": 1392, "function": "load"}}
{"timestamp": "2025-11-26T20:25:35.341958Z", "level": "INFO", "logger": "src.agent_manager", "message": "Bedrock model initialized successfully", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 106, "function": "_initialize_bedrock_model"}}
{"timestamp": "2025-11-26T20:25:35.342026Z", "level": "INFO", "logger": "src.agent_manager", "message": "Registering 5 custom tools with agent", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 158, "function": "_initialize_agent"}}
{"timestamp": "2025-11-26T20:25:35.342376Z", "level": "INFO", "logger": "src.agent_manager", "message": "Agent initialized with custom tools and system prompt", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 167, "function": "_initialize_agent"}}
{"timestamp": "2025-11-26T20:25:35.342418Z", "level": "INFO", "logger": "src.agent_manager", "message": "AgentManager initialized successfully", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 58, "function": "__init__"}}
{"timestamp": "2025-11-26T20:25:35.342443Z", "level": "INFO", "logger": "src.api.routes", "message": "Agent manager initialized successfully", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/api/routes.py", "line": 49, "function": "initialize_agent_manager"}}
{"timestamp": "2025-11-26T20:25:35.342464Z", "level": "INFO", "logger": "src.main", "message": "Agent manager initialized successfully", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 161, "function": "lifespan"}}
{"timestamp": "2025-11-26T20:25:35.342483Z", "level": "INFO", "logger": "src.main", "message": "Service is ready to accept requests", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 162, "function": "lifespan"}}
INFO:     Application startup complete.
{"timestamp": "2025-11-26T20:25:57.681985Z", "level": "INFO", "logger": "src.main", "message": "Incoming request: POST /api/v1/chat", "event_type": "http_request", "request_id": "1764188757681", "method": "POST", "path": "/api/v1/chat", "client_host": "127.0.0.1", "query_params": {}, "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 66, "function": "dispatch"}}
{"timestamp": "2025-11-26T20:25:57.682807Z", "level": "INFO", "logger": "src.api.routes", "message": "Incoming request", "event_type": "request", "user_message": "Hello! What products do you have?", "session_id": "", "user_id": "test-user", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/utils/logging.py", "line": 139, "function": "log_request"}}
{"timestamp": "2025-11-26T20:25:57.682896Z", "level": "INFO", "logger": "src.agent_manager", "message": "Created new session: 3ce0f303-e34c-4084-bf74-9a2af5cc4b47", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 207, "function": "process_message"}}
{"timestamp": "2025-11-26T20:25:57.682931Z", "level": "INFO", "logger": "src.agent_manager", "message": "Processing message for session 3ce0f303-e34c-4084-bf74-9a2af5cc4b47, user test-user: Hello! What products do you have?...", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 213, "function": "process_message"}}
{"timestamp": "2025-11-26T20:25:57.683220Z", "level": "INFO", "logger": "strands.telemetry.metrics", "message": "Creating Strands MetricsClient", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/telemetry/metrics.py", "line": 478, "function": "__init__"}}
{"timestamp": "2025-11-26T20:25:58.019331Z", "level": "ERROR", "logger": "src.agent_manager", "message": "Failed to process message for session 3ce0f303-e34c-4084-bf74-9a2af5cc4b47: Error processing message: An error occurred (UnrecognizedClientException) when calling the ConverseStream operation: The security token included in the request is invalid.", "exc_info": "Traceback (most recent call last):\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py\", line 231, in process_message\n    response = await self.agent.invoke_async(\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<2 lines>...\n    )\n    ^\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/agent/agent.py\", line 392, in invoke_async\n    async for event in events:\n        _ = event\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/agent/agent.py\", line 588, in stream_async\n    async for event in events:\n    ...<5 lines>...\n            yield as_dict\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/agent/agent.py\", line 636, in _run_loop\n    async for event in events:\n    ...<13 lines>...\n        yield event\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/agent/agent.py\", line 684, in _execute_event_loop_cycle\n    async for event in events:\n        yield event\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/event_loop/event_loop.py\", line 152, in event_loop_cycle\n    async for model_event in model_events:\n        if not isinstance(model_event, ModelStopReason):\n            yield model_event\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/event_loop/event_loop.py\", line 396, in _handle_model_execution\n    raise e\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/event_loop/event_loop.py\", line 337, in _handle_model_execution\n    async for event in stream_messages(\n    ...<7 lines>...\n        yield event\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/event_loop/streaming.py\", line 457, in stream_messages\n    async for event in process_stream(chunks, start_time):\n        yield event\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/event_loop/streaming.py\", line 391, in process_stream\n    async for chunk in chunks:\n    ...<22 lines>...\n            handle_redact_content(chunk[\"redactContent\"], state)\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/models/bedrock.py\", line 647, in stream\n    await task\n  File \"/opt/homebrew/Cellar/python@3.13/3.13.3/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/threads.py\", line 25, in to_thread\n    return await loop.run_in_executor(None, func_call)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/homebrew/Cellar/python@3.13/3.13.3/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py\", line 59, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/opentelemetry/instrumentation/threading/__init__.py\", line 171, in wrapped_func\n    return original_func(*func_args, **func_kwargs)\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/models/bedrock.py\", line 768, in _stream\n    raise e\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/strands/models/bedrock.py\", line 683, in _stream\n    response = self.client.converse_stream(**request)\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/botocore/client.py\", line 602, in _api_call\n    return self._make_api_call(operation_name, kwargs)\n           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/botocore/context.py\", line 123, in wrapper\n    return func(*args, **kwargs)\n  File \"/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/venv/lib/python3.13/site-packages/botocore/client.py\", line 1078, in _make_api_call\n    raise error_class(parsed_response, operation_name)\nbotocore.exceptions.ClientError: An error occurred (UnrecognizedClientException) when calling the ConverseStream operation: The security token included in the request is invalid.\n\u2514 Bedrock region: us-east-1\n\u2514 Model id: us.amazon.nova-pro-v1:0", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/agent_manager.py", "line": 262, "function": "process_message"}}
{"timestamp": "2025-11-26T20:25:58.019499Z", "level": "INFO", "logger": "src.api.routes", "message": "Outgoing response", "event_type": "response", "agent_response": "I apologize, but I encountered an error processing your request. Please try again or rephrase your question.", "session_id": "3ce0f303-e34c-4084-bf74-9a2af5cc4b47", "user_id": "test-user", "status": "error", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/utils/logging.py", "line": 170, "function": "log_response"}}
{"timestamp": "2025-11-26T20:25:58.019538Z", "level": "WARNING", "logger": "src.api.routes", "message": "Agent returned error status for session : Error processing message: An error occurred (UnrecognizedClientException) when calling the ConverseStream operation: The security token included in the request is invalid.", "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/api/routes.py", "line": 213, "function": "chat_endpoint"}}
{"timestamp": "2025-11-26T20:25:58.019702Z", "level": "INFO", "logger": "src.main", "message": "Outgoing response: POST /api/v1/chat - 503", "event_type": "http_response", "request_id": "1764188757681", "method": "POST", "path": "/api/v1/chat", "status_code": 503, "duration_ms": 337.63, "source": {"file": "/Users/halilb/AWSWorks/KiroProjects/shopping-assistant-chatbot/src/main.py", "line": 89, "function": "dispatch"}}
INFO:     127.0.0.1:49614 - "POST /api/v1/chat HTTP/1.1" 503 Service Unavailable
